{% extends "base/base.html" %}

{% block content %}
<div class="auth-wrap">
    <div class="instruction-card" style="max-width: 900px;">
        <h1><i class="fa-solid fa-trophy" style="color: #fbbf24; margin-right: 0.5rem;"></i> Leaderboard</h1>
        <h3 style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Top Performers</h3>

        <!-- Category Tabs -->
        <div class="category-tabs"
            style="display: flex; gap: 1rem; margin-bottom: 2rem; overflow-x: auto; padding-bottom: 0.5rem; justify-content: center;">
            {% for category in categories %}
            <a href="?category={{ category.id }}"
                class="tab-link {% if category.id == active_category.id %}active{% endif %}" style="padding: 0.5rem 1.5rem; border-radius: 50px; font-weight: 600; font-size: 0.95rem; white-space: nowrap; transition: all 0.3s ease; text-decoration: none;
                      {% if category.id == active_category.id %}
                      background: var(--gradient-main); color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
                      {% else %}
                      background: var(--bg-body); color: var(--text-muted); border: 1px solid rgba(0,0,0,0.05);
                      {% endif %}">
                {{ category.name }}
            </a>
            {% endfor %}
        </div>

        <div class="category-leaderboard" style="margin-bottom: 3rem;">
            <h2 class="text-gradient" style="margin-bottom: 1rem; text-align: center;">{{ active_category.name }}
                Leaderboard</h2>

            {% if attempts %}
            <div class="table-responsive">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th width="10%">Rank</th>
                            <th>User</th>
                            <th>Quiz</th>
                            <th>Score</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for attempt in attempts %}
                        <tr class="{% if forloop.counter <= 3 %}top-rank{% endif %}">
                            <td>
                                {% if forloop.counter == 1 %}
                                <i class="fa-solid fa-crown" style="color: #fbbf24;"></i>
                                {% elif forloop.counter == 2 %}
                                <i class="fa-solid fa-medal" style="color: #94a3b8;"></i>
                                {% elif forloop.counter == 3 %}
                                <i class="fa-solid fa-medal" style="color: #b45309;"></i>
                                {% else %}
                                #{{ forloop.counter }}
                                {% endif %}
                            </td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div
                                        style="width: 32px; height: 32px; background: var(--bg-body); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary);">
                                        {{ attempt.user.username|make_list|first|upper }}
                                    </div>
                                    {{ attempt.user.username }}
                                </div>
                            </td>
                            <td>{{ attempt.quiz.title }}</td>
                            <td>
                                <span class="score-badge">{{ attempt.score }} / {{ attempt.total }}</span>
                            </td>
                            <td style="font-size: 0.9rem; color: var(--text-muted);">
                                {{ attempt.created_at|date:"M d, Y" }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div
                style="text-align: center; padding: 3rem; background: var(--bg-body); border-radius: var(--radius-lg);">
                <i class="fa-regular fa-folder-open"
                    style="font-size: 2rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                <h3 style="color: var(--text-main); margin-bottom: 0.5rem;">No attempts yet</h3>
                <p style="color: var(--text-muted);">Be the first to top the leaderboard in {{ active_category.name }}!
                </p>
            </div>
            {% endif %}
        </div>

        <div style="text-align: center; margin-top: 3rem;">
            <a href="{% url 'quiz_list' %}" class="cta-button">Take a Quiz</a>
        </div>
    </div>
</div>
{% endblock %}